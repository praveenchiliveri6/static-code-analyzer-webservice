/*
 * The copyright of this file belongs to Koninklijke Philips N.V., 2019.
 */
package com.trg.boot.service;

import java.io.IOException;
import java.util.Map;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.trg.boot.input.SourceInput;

@Service
public class SecurityService {


  @Autowired
  ParsingService sgs;
  String vcgPath = "C:\\Program Files (x86)\\VisualCodeGrepper";



  public int generateCSVReport(SourceInput si) throws IOException, InterruptedException {

    final String[] securityCommand = {"cmd", "/c", "VisualCodeGrepper.exe", "-c", "-l",
        si.getProgLang(), "-t", si.getSourceCode(), "--results", si.getDestPath() + "report.txt"};
    final ProcessBuilder pb = new ProcessBuilder(securityCommand);
    final Map<String, String> envMap = pb.environment();
    String path = envMap.get("Path");
    path += vcgPath;


    envMap.put("Path", path);
    final Process p = pb.start();
    p.waitFor();
    return sgs.parseCSVFile(si);

  }

}
